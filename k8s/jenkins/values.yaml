controller:
  image:
    repository: "jenkins/jenkins"
    tag: "lts"

  admin:
    username: "admin"
    password: "admin123"

  # Expose via NodePort for Minikube access
  serviceType: NodePort
  nodePort: 32000

  # ─── CRITICAL: Enable the agent TCP listener (port 50000) ───
  agentListenerEnabled: true
  agentListenerPort: 50000

  # ─── Plugins ───
  installPlugins:
    - kubernetes:latest
    - workflow-aggregator:latest
    - git:latest
    - pipeline-stage-view:latest
    - timestamper:latest
    - ws-cleanup:latest
    - pipeline-utility-steps:latest

  # ─── Environment ───
  containerEnv:
    - name: JAVA_OPTS
      value: "-Djava.net.preferIPv4Stack=true -Djenkins.install.runSetupWizard=false"

  # ─── JCasC: auto-configure Kubernetes Cloud on startup ───
  JCasC:
    defaultConfig: true
    configScripts:
      kubernetes-cloud: |
        jenkins:
          systemMessage: "CodeArena CI/CD — Jenkins"
          clouds:
            - kubernetes:
                name: "kubernetes"
                serverUrl: "https://kubernetes.default.svc.cluster.local"
                skipTlsVerify: true
                namespace: "jenkins"
                jenkinsUrl: "http://jenkins.jenkins.svc.cluster.local:8080"
                jenkinsTunnel: "jenkins-agent.jenkins.svc.cluster.local:50000"
                webSocket: false
                connectTimeout: 300
                readTimeout: 600
                containerCapStr: "50"
                maxRequestsPerHostStr: "32"
                podRetention: "onFailure"
                retentionTimeout: 5
                waitForPodSec: 600

  # Kubernetes Agent Configuration
  agent:
    enabled: true
    podName: "default"
    containerName: "jnlp"

persistence:
  enabled: true
  size: 8Gi
